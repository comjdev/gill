<!-- prettier-ignore -->
<%
// Get the page slug from the page object
var pageData = page.data;
var service = site.data[pageData];

// Filter testimonials by service type at the top
var allTestimonials = site.data.testimonials.testimonials;
var serviceTestimonials = allTestimonials.filter(function(testimonial) {
  return testimonial.type === pageData;
}).slice(0, 3); // Get first 3 testimonials for this service
%>

<!-- prettier-ignore -->
<% if (service.intro) { %>
<!-- Intro -->
<%- include('_partials/service/intro', {service: service, page: page}) %> <% }
%>

<!-- prettier-ignore -->
<% if (service.what_to_expect) { %>
<!-- What to expect -->
<%- include('_partials/service/what-to-expect', {service: service, page: page})
%> <% } %>

<!-- Testimonial Section 1 -->
<!-- prettier-ignore -->
<% if (serviceTestimonials.length > 0) { %>
  <%- include('_partials/service-testimonial', { testimonial: serviceTestimonials[0] }) %>
<% } %>

<!-- prettier-ignore -->
<% if (service.location) { %>
<!-- Location -->
<%- include('_partials/service/location', {service: service, page: page}) %> <%
} %>

<!-- prettier-ignore -->
<% if (service.process) { %>
<!-- Process -->
<%- include('_partials/service/process', {service: service, page: page}) %> <% }
%>

<!-- Testimonial Section 2 -->
<!-- prettier-ignore -->
<% if (serviceTestimonials.length > 1) { %>
  <%- include('_partials/service-testimonial', { testimonial: serviceTestimonials[1] }) %>
<% } %>

<!-- prettier-ignore -->
<% if (service.investment) {
  var prices = {
    heading: service.investment.title || 'Investment',
    intro: service.investment.subtitle || '',
    packages: service.investment.packages ? service.investment.packages.map(function(package) {
      return {
        title: package.name,
        price: package.price,
        description: package.features,
        most_popular: package.most_popular || false
      };
    }) : [
      {
        title: service.investment.title || 'Package',
        price: '', // Fallback if no packages defined
        description: service.investment.copy || [],
        most_popular: false
      }
    ]
  };
%>
<!-- Pricing Table -->
<%- include('_partials/service/prices', {prices: prices}) %> <% } %>

<!-- Testimonial Section 3 -->
<!-- prettier-ignore -->
<% if (serviceTestimonials.length > 2) { %>
  <%- include('_partials/service-testimonial', { testimonial: serviceTestimonials[2] }) %>
<% } %>


<% if (service.faqs) { %>
<!-- FAQs -->
<!-- prettier-ignore -->
<%- include('_partials/faqs', {faqs: service.faqs, title: 'Frequently Asked Questions'}) %>
<% } %>

<!-- Latest Projects -->
<%- include('_partials/projects-slider', { category: pageData, limit: 6,
showCategoryInHeading: true }) %>
